---
- name: install required software
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - bash-completion
    - emacs
    - firewalld
    - iftop
    - iotop
    - mailx
    - postfix
    - python2-speedtest-cli
    - tree
    - yum-cron
  become: yes
- name: install VMware Tools
  package:
    name: open-vm-tools
    state: present
  when: vmware_tools
  become: yes
- name: set hostname
  hostname:
    name: "{{ hostname }}"
  become: yes
- name: set up user accounts
  user:
    name: "{{ item.login }}"
    groups: "{{ item.supplementary_groups }}"
    state: present
  with_items: "{{ shell_accounts }}"
  become: yes
- name: configure user aliases
  lineinfile:
    dest: /etc/aliases
    regexp: "^#?{{ item.login }}:"
    line: "{{ item.login }}: {{ item.alias }}"
  with_items: "{{ shell_accounts }}"
  notify:
    - run newaliases
  become: yes
- name: configure root alias
  lineinfile:
    dest: /etc/aliases
    regexp: "^#?root:"
    line: "root: {{ root_alias }}"
  notify:
    - run newaliases
  become: yes
- name: make journal persistent
  file:
    path: /var/log/journal
    state: directory
  when: persistent_journal
  become: yes
- name: configure yum-cron notifications
  lineinfile:
    dest: /etc/yum/yum-cron.conf
    regexp: "^emit_via ="
    line: emit_via = email
  notify:
    - restart yum-cron
  become: yes
- name: configure yum-cron auto-update
  lineinfile:
    dest: /etc/yum/yum-cron.conf
    regexp: "^apply_updates ="
    line: "apply_updates = {{ auto_update | ternary('yes', 'no') }}"
  notify:
    - restart yum-cron
  become: yes
- name: start services
  service:
    name: "{{ item }}"
    state: started
    enabled: yes
  with_items:
    - firewalld
    - postfix
    - yum-cron
  become: yes
